# SPDX-FileCopyrightText: Copyright (c) 2023-2024 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: LicenseRef-NvidiaProprietary
#
# NVIDIA CORPORATION, its affiliates and licensors retain all intellectual
# property and proprietary rights in and to this material, related
# documentation and any modifications thereto. Any use, reproduction,
# disclosure or distribution of this material and related documentation
# without an express license agreement from NVIDIA CORPORATION or
# its affiliates is strictly prohibited.
---
- job-template:
    name: '{name}-{build_type}'
    project-type: pipeline
    properties:
        - build-discarder:
            days-to-keep: 50
            num-to-keep: 20
        - inject:
            keep-system-variables: true
            properties-content: |
              jjb_proj='{name}-{build_type}'
    description: Do NOT edit this job through the Web GUI !
    concurrent: true
    sandbox: true
    parameters:
        - string:
            name: "REFSPEC"
            default: "{refspec_default_value}"
            description: "{refspec_description}"
        - bool:
            name: "do_container"
            default: true
            description: "Build docker containers"
        - bool:
            name: "do_resources"
            default: true
            description: "Release resource files"
        - bool:
            name: "build_dockers"
            default: false
            description: "Rebuild CI docker containers"
        - string:
            name: "conf_file"
            default: "{conf_file}"
            description: "Regex to select job config file"
        - string:
            name: "script"
            default: "{jjb_jenkinsfile}"
            description: "Jenkinsfile to load"
    pipeline-scm:
        scm:
            - git:
                url: "{jjb_git}"
                credentials-id: 'mellanox-github-id-rsa'
                branches: ['FETCH_HEAD']
                shallow-clone: true
                depth: 1
                honor-refspec: true
                refspec: "$REFSPEC"
                browser: githubweb
                browser-url: "{jjb_git}"
                submodule:
                  recursive: true
                  parent-credentials: true
                wipe-workspace: true
        script-path: "$script"

- project:
    name: doca-nvmf-target-offload
    jjb_email: 'andriih@nvidia.com'
    jjb_git: 'git@github.com:Mellanox/spdk.git'
    jjb_owner: 'andriih@nvidia.com'
    jjb_jenkinsfile: '.ci/Jenkinsfile.shlib'
    build_type:
        - release:
            conf_file: '.ci/job_matrix_doca_nvmf_target_offload.yaml'
            refspec_default_value: 'refs/heads/v24.01.3.nvda.tgt_offload'
            refspec_description: |
              <p>refspec to checkout by git. By default <b>refs/heads/main</b><br />
              You can change it to checkout to a specific <b>branch</b>, <b>pull request</b> or <b>tag</b><br />
              Examples:</p>
              <ul>
                <li><b>refs/heads/v24.01.3.nvda.tgt_offload</b> - will checkout into v24.01.3.nvda.tgt_offload branch</li>
                <li><b>refs/pull/1274/head</b> - will checkout into pull request 1274</li>
                <li><b>refs/tags/v0.0.0-1</b> - will checkout into v0.0.0-1 tag</li>
              </ul>
    jobs:
        - '{name}-{build_type}'
